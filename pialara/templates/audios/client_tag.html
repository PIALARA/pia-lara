{% extends 'layout.html' %}

{% block content %}
  <header class="header">
    <h1 class="text-center">Etiquetas</h1>
  </header>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

<section>

  <!-- Buscador -->
  <form class="tags-form" method="post" action="{{ url_for('audios.tag_search') }}">
    <input class="tags-form__input"
           type="search"
           name="tagName"
           placeholder="Buscar etiqueta..."
           value="{{ tag_name }}" />
    <button class="tags-form__button btn btn-primary" type="submit">
      <i class="bi bi-search me-2"></i>
    </button>
  </form>

  <!-- Bot√≥n suerte -->
  <div class="tags-container">
    {% for tag in tags_suerte %}
      <a class="btn btn-info" href="/audios/client-record/{{ tag._id }}">
        ¬øVoy a tener suerte?
      </a>
    {% endfor %}
  </div>

  <!-- ETIQUETAS -->
  {% if not tags %}
  <div class="tags-container">
    <fieldset>
      üéôÔ∏è Audios grabados: <strong>{{ total_audios[0].total if total_audios else 0 }}</strong>
    </fieldset>
  </div>

  <div class="tags-container">
    <fieldset>
      <legend>√öltimas 5 etiquetas grabadas</legend>
      {% for x in ultimas_etiquetas %}
        <a class="tag button"
           href="/audios/client-record/{{ x.tag }}" title="Total audios grabados: {{ x.total }}">
          {{ x.tag.upper() }}
        </a>
      {% endfor %}
    </fieldset>
  </div>

  <div class="tags-container">
    <fieldset>
      <legend>5 etiquetas m√°s grabadas</legend>
      {% for x in top_etiquetas %}
        <a class="tag button"
           href="/audios/client-record/{{ x.tag }}" title="Total audios grabados: {{ x.total }}">
          {{ x.tag.upper() }}
        </a>
      {% endfor %}
    </fieldset>
  </div>

  <div class="tags-container">
    <fieldset>
      <legend>5 etiquetas menos grabadas</legend>
      {% for x in bottom_etiquetas %}
        <a class="tag button"
           href="/audios/client-record/{{ x.tag }}" title="Total audios grabados: {{ x.total }}">
          {{ x.tag.upper() }}
        </a>
      {% endfor %}
    </fieldset>
  </div>

  <!-- FONEMAS -->
  <!-- TODO: sobre un fonema, crear un m√©todo /client-fonema/ Wque recupere todas las etiquetas asociadas, y devuelva una aleatoria, y de ah√≠, un redirect a client-record
  <div class="tags-container">
    <fieldset>
      <legend>√öltimos 5 fonemas grabados</legend>
      {% for x in ultimos_fonemas %}
        <span class="tag button">
          {{ x.fonema.upper() }}
        </span>
      {% endfor %}
    </fieldset>

    <fieldset>
      <legend>5 fonemas m√°s grabados</legend>
      {% for x in top_fonemas %}
        <span class="tag button">
          {{ x.fonema.upper() }} ({{ x.total }})
        </span>
      {% endfor %}
    </fieldset>

    <fieldset>
      <legend>5 fonemas menos grabados</legend>
      {% for x in bottom_fonemas %}
        <span class="tag button">
          {{ x.fonema.upper() }} ({{ x.total }})
        </span>
      {% endfor %}
    </fieldset>
  </div>
  -->
  {% endif %}

  <!-- Resultados b√∫squeda -->
  {% if tags %}
  <div class="tags-container">
    <fieldset>
      <legend>Etiquetas encontradas</legend>
      {% for tag in tags %}
        <a class="tag button"
           href="/audios/client-record/{{ tag._id }}">
          {{ tag._id.upper() }}
        </a>
      {% endfor %}
    </fieldset>
  {% endif %}
  </div>

</section>
{% endblock %}